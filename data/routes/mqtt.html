<h2 style="text-align: center; margin-bottom: 0;">MQTT Configuration</h2>
<h5 style="text-align:center;margin-top: 0;">Changes in this section will reboot the device</h5>
<form id="mqttConfig" action="mqttconfig" method="post"
  style="display: inline-flex; flex-direction: column;margin-bottom: 0;align-items: center;">
  <div class="cards-container" style="display: flex;gap: 16px;">
    <div id="mqtt-broker-con" style="display: flex;flex-direction: column;border: 1px #8e8271 solid;border-radius: 8px;padding: 1rem;box-shadow: 0px 1px 1px 0px;background-color: #2d1d1d;">
      <h3 style="margin-top: 0;text-align: center;margin-bottom: .5rem;">Broker Connection</h3>
      <h5 style="text-align: center;margin-top: 0;margin-bottom: .5rem;">TCP - Without TLS</h5>
      <div style="display:flex;flex-direction: column;padding: .5rem;margin-bottom: .5rem;gap: 8px;">
        <div style="display: flex;gap: 8px;">
          <div style="display: flex; flex-direction: column;flex: 2;">
            <label for="mqtt-broker">Address</label>
            <input type="text" name="mqtt-broker" id="mqtt-broker" placeholder="0.0.0.0" required value="%MQTTBROKER%">
          </div>
          <div style="display: flex; flex-direction: column;flex: .5;">
            <label for="mqtt-port">Port</label>
            <input type="number" name="mqtt-port" id="mqtt-port" placeholder="1883" required inputmode="numeric" value="%MQTTPORT%" min="0" max="65535">
          </div>
        </div>
        <div style="display: flex; flex-direction: column;">
          <label for="mqtt-clientid">Client ID</label>
          <input type="text" name="mqtt-clientid" id="mqtt-clientid" placeholder="homekey_mqtt" required value="%MQTTCLIENTID%">
        </div>
        <div style="display:flex;flex-direction: column;">
          <label for="mqtt-lwt-topic">LWT Topic</label>
          <input type="text" name="mqtt-lwt-topic" id="mqtt-lwt-topic" placeholder="homekey_mqtt/status" required value="%MQTTLWTTOPIC%">
        </div>
      </div>
      <div style="display:flex;flex-direction: column;padding: .5rem;margin-bottom: .5rem;gap: 8px;">
        <div style="display: flex; flex-direction: column;">
          <label for="mqtt-username">Username</label>
          <input type="text" name="mqtt-username" id="mqtt-username" placeholder="username" value="%MQTTUSERNAME%">
        </div>
        <div style="display: flex; flex-direction: column;">
          <label for="mqtt-password">Password</label>
          <input type="password" name="mqtt-password" id="mqtt-password" placeholder="password" value="%MQTTPASSWORD%">
        </div>
      </div>
      <div style="display:flex;flex-direction: column;padding: .5rem;gap: 8px;">
        <div style="display:flex;flex-direction: column;">
          <label for="mqtt-discovery-enable">HASS MQTT Discovery</label>
          <select name="mqtt-discovery-enable" id="mqtt-discovery-enable">
            <option value="0">Disabled</option>
            <option value="1">Enabled</option>
          </select>
        </div>
      </div>
    </div>
    <div id="mqtt-topics-container" style="display: flex;flex-direction: column;border: 1px #8e8271 solid;border-radius: 8px;padding: 1rem;box-shadow: 0px 1px 1px 0px;background-color: #2d1d1d;">
      <h3 style="text-align: center;margin-top: 0;">MQTT Topics</h3>
      <div style="margin-bottom: 1rem;">
        <div id="mqtt-topics" style="display: flex;justify-content: space-around;">
          <h3 class="mqtt-topics-selected-tab"
          style="margin: 0;width: fit-content;padding: 0.5rem;cursor: pointer;"
          onclick="switchTab(this)" data-tab-index="0">Core Topics</h3>
          <h3
          style="margin: 0;width: fit-content;padding: 0.5rem;cursor: pointer;"
          onclick="switchTab(this)" data-tab-index="1">Custom Topics</h3>
        </div>
        <span style="height: 1px;border-top: 1px #424242 solid;display: block;margin: 0;padding: 0;"></span>
      </div>
      <div class="mqtt-topics-selected-body" data-mqtt-topics-body="0">
        <div style="display: flex;flex-direction: column;gap: 8px;">
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-hktopic">NFC/HK Topic</label>
            <input type="text" name="mqtt-hktopic" id="mqtt-hktopic" placeholder="topic/auth" required value="%HKTOPIC%">
          </div>
          <div style="display: flex;flex-direction: column;">
            <label for="nfc-tags-ignore-mqtt">Ignore NFC Tags</label>
            <select name="nfc-tags-ignore-mqtt" id="nfc-tags-ignore-mqtt">
                <option value="0">Disabled</option>
                <option value="1">Enabled</option>
            </select>
        </div>
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-statetopic">Lock State Topic</label>
            <input type="text" name="mqtt-statetopic" id="mqtt-statetopic" placeholder="topic/state" required value="%STATETOPIC%">
          </div>
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-statecmd">Lock State Cmd Topic</label>
            <input type="text" name="mqtt-statecmd" id="mqtt-statecmd" placeholder="topic/set_state" required value="%STATECMD%">
          </div>
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-cstatecmd">Lock Current State Cmd Topic</label>
            <input type="text" name="mqtt-cstatecmd" id="mqtt-cstatecmd" placeholder="topic/set_current_state" required value="%CSTATECMD%">
          </div>
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-tstatecmd">Lock Target State Cmd Topic</label>
            <input type="text" name="mqtt-tstatecmd" id="mqtt-tstatecmd" placeholder="topic/set_target_state" required value="%TSTATECMD%">
          </div>
          <div style="display: flex; flex-direction: column;">
            <label for="mqtt-btrprox-cmd-topic">SmartLock battery level Cmd Topic</label>
            <input type="text" name="mqtt-btrprox-cmd-topic" id="mqtt-btrprox-cmd-topic" placeholder="topic/set_battery_level" required value="%BTRLEVELCMD%">
          </div>
        </div>
      </div>
      <div class="mqtt-topics-hidden-body" data-mqtt-topics-body="1">
        <div style="display: flex;flex-direction: column;gap: 8px;">
          <div style="display: flex;flex-direction: column;">
            <label for="mqtt-customstate-enable">MQTT Custom State Topics</label>
            <select name="mqtt-customstate-enable" id="mqtt-customstate-enable">
              <option value="0">Disabled</option>
              <option value="1">Enabled</option>
            </select>
          </div>
          <div style="display: flex;flex-direction: column;">
            <label for="mqtt-customstate-topic">MQTT Custom State Topic</label>
            <input type="text" name="mqtt-customstate-topic" id="mqtt-customstate-topic" placeholder="topic/set_target_state" required value="%CUSTOMSTATETOPIC%">
          </div>
          <div style="display: flex;flex-direction: column;">
            <label for="mqtt-customstate-cmd">MQTT Custom State Cmd Topic</label>
            <input type="text" name="mqtt-customstate-cmd" id="mqtt-customstate-cmd" placeholder="topic/set_target_state" required value="%CUSTOMSTATECMD%">
          </div>
        </div>
        <div style="display: flex;flex-direction: column;gap: 16px;">
          <fieldset>
            <legend>Custom Lock Actions </legend>
            <div
              style="display: flex; gap: 16px;justify-content: center;flex-wrap: wrap;padding: .5rem;">
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="caction-unlock">Unlock</label>
                <input type="number" name="caction-unlock" id="caction-unlock" placeholder="255" value="%CACTIONUNLOCK%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="caction-lock">Lock</label>
                <input type="number" name="caction-lock" id="caction-lock" placeholder="255" value="%CACTIONLOCK%" min="0" max="255">
              </div>
            </div>
          </fieldset>
          <fieldset>
            <legend>Custom Lock States </legend>
            <div
              style="display: flex; gap: 16px;flex-wrap: wrap;justify-content: center;padding: .5rem;">
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-unlocking">Unlocking</label>
                <input type="number" name="cstate-unlocking" id="cstate-unlocking" placeholder="255" value="%CSTATEUNLOCKING%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-locking">Locking</label>
                <input type="number" name="cstate-locking" id="cstate-locking" placeholder="255" value="%CSTATELOCKING%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-unlocked">Unlocked</label>
                <input type="number" name="cstate-unlocked" id="cstate-unlocked" placeholder="255" value="%CSTATEUNLOCKED%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-locked">Locked</label>
                <input type="number" name="cstate-locked" id="cstate-locked" placeholder="255" value="%CSTATELOCKED%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-jammed">Jammed</label>
                <input type="number" name="cstate-jammed" id="cstate-jammed" placeholder="255" value="%CSTATEJAMMED%" min="0" max="255">
              </div>
              <div style="display: flex; flex-direction: column; max-width: 70px;">
                <label for="cstate-unknown">Unknown</label>
                <input type="number" name="cstate-unknown" id="cstate-unknown" placeholder="255" value="%CSTATEUNKNOWN%" min="0" max="255">
              </div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
  </div>
  <div id="buttons-group">
    <button type="submit" style="cursor: pointer;padding-inline: 1rem;padding-block: .5rem;">Submit</button>
    <button type="reset" style="cursor: pointer;padding-inline: 1rem;padding-block: .5rem;"
      class="destructive-btn">Reset</button>
  </div>
</form>
<script>
  document.getElementById("mqtt-customstate-enable").selectedIndex = "%CUSTOMSTATE_ENABLED%";
  document.getElementById("mqtt-discovery-enable").selectedIndex = "%DISCOVERY_ENABLED%";
  document.getElementById("nfc-tags-ignore-mqtt").selectedIndex = "%NFCTAGSNOPUBLISH%";
  let form = document.getElementById("mqttConfig");
  async function handleForm(event) {
    event.preventDefault();
    let response = await fetch("mqttconfig", {
      body: new FormData(form),
      method: "post",
    });
    let string = await response.text();
    let component = document.getElementById("buttons-group");
    let elStatus = document.createElement("h4");
    elStatus.id = "status-text";
    elStatus.style = "color: red;text-align: center;margin-bottom: 0;";
    elStatus.innerText = string;
    component.insertAdjacentElement("beforebegin", elStatus);
    setTimeout(() => { document.querySelector("#status-text").remove() }, 5000);
  }
  form.addEventListener('submit', handleForm);
</script>